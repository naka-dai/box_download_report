================================================================================
Box Daily Update - セットアップ手順（別PCへの配置）
================================================================================

■ 概要
このフォルダには、Box図面活用状況レポートを毎日自動更新するための
必要なファイルがすべて含まれています。

★ 設定済み ★
・config.json（Box JWT認証ファイル）同梱済み
・.env（設定ファイル）事前設定済み
・BOX_ROOT_FOLDER_ID=243194687037 設定済み

→ フォルダをコピーするだけで、すぐに実行できます！


■ 配置手順（超簡単！）

1. このフォルダ（box_daily_update）をそのまま任意の場所にコピー
   例: C:\BoxReports\box_daily_update\

2. すぐに実行可能！
   ※ 設定ファイルの編集は不要です


■ 手動実行でテスト

フォルダをコピーしたら、すぐに手動実行でテストできます。

1. コマンドプロンプトを開く

2. フォルダに移動
   cd C:\BoxReports\box_daily_update

3. EXEを実行
   box_daily_update.exe

4. 実行結果を確認
   - ステップ1: Box APIから最新データ取得 → SQLiteデータベース保存
   - ステップ2: ダッシュボード生成 → data\dashboard_period_allinone_full.html

5. 生成されたダッシュボードをブラウザで開く
   data\dashboard_period_allinone_full.html

注意: すべてのデータはBox API経由で取得されます。
     BoxドライブやBoxレポートCSVファイルは不要です。


■ タスクスケジューラ設定

1. Windowsのタスクスケジューラを起動
   - スタートメニューから「タスク スケジューラ」で検索

2. 「基本タスクの作成」をクリック

3. 設定内容:
   名前: Box Daily Update - 図面活用状況レポート
   説明: Box APIからデータ収集し、図面活用状況ダッシュボードを自動生成

   トリガー: 毎日
   開始時刻: 午前2時（または任意の時刻）

   操作: プログラムの開始
   プログラム/スクリプト:
     C:\BoxReports\box_daily_update\box_daily_update.exe
     ※ 実際に配置したフルパスを指定

   開始:
     C:\BoxReports\box_daily_update
     ※ EXEファイルがあるフォルダパスを指定

4. 「完了」をクリック


■ 実行内容

box_daily_update.exe は以下の処理を自動実行します:

【ステップ1】Box APIデータ収集
  - Box APIから最新のダウンロード/プレビューログを取得
  - SQLiteデータベース（data/box_audit.db）に保存
  - 重複データは自動スキップ

【ステップ2】ダッシュボード生成
  - データベースからデータを集計
  - 期間フィルター付きHTMLダッシュボードを生成
    ファイル: data/dashboard_period_allinone_full.html
  - 完全オフライン動作（インターネット接続不要）


■ 出力ファイル

実行後、以下のファイルが生成されます:

- data/box_audit.db
  SQLiteデータベース（累積データ）

- data/dashboard_period_allinone_full.html
  図面活用状況ダッシュボード（約1.6 MB）

  機能:
  ・期間フィルター: 全期間/運用開始前/運用開始後
  ・3つのタブ: 統合レポート/ダウンロードのみ/プレビューのみ
  ・マウスオーバーでユーザー詳細表示
  ・月別/日別/時間帯別グラフ


■ 設定ファイルについて

このパッケージには以下の設定が事前に組み込まれています:

【config.json】
  Box JWT認証ファイル
  → 変更不要（そのまま使用）

【.env】
  設定ファイル（事前設定済み）
  主な設定内容:
  - BOX_ROOT_FOLDER_ID=243194687037
  - BOX_CONFIG_PATH=config.json
  - DB_PATH=./data/box_audit.db
  - REPORT_OUTPUT_DIR=./data
  → すべて相対パスで設定済み（フォルダ内に出力）
  → 変更不要（そのまま使用）

【.env.sample】
  設定ファイルのサンプル
  → カスタマイズが必要な場合の参考用


■ トラブルシューティング

● エラー: Box API認証エラー
  → config.jsonが最新版か確認
  → Box Developer Consoleでアプリケーションが承認されているか確認
  → config.jsonの有効期限が切れていないか確認

● データベースエラー
  → dataフォルダに書き込み権限があるか確認
  → ウイルス対策ソフトがブロックしていないか確認

● ダッシュボードが生成されない
  → データ収集が正常に完了しているか確認
  → dataフォルダが存在するか確認（自動作成されるはず）


■ フォルダ構成

box_daily_update/
├── box_daily_update.exe              ← メイン実行ファイル（7.5 MB）
├── config.json                        ← Box JWT認証ファイル（同梱済み）★
├── .env                               ← 設定ファイル（事前設定済み）★
├── .env.sample                        ← 設定サンプル
├── data/                              ← データ出力フォルダ
│   ├── box_audit.db                   ← SQLiteデータベース（自動生成）
│   └── dashboard_period_allinone_full.html  ← ダッシュボード（自動生成）
├── README.txt                         ← クイックスタートガイド
└── セットアップ手順.txt              ← このファイル


■ 注意事項

- box_daily_update.exe は全ての依存ライブラリを含んでいます
- Pythonのインストールは不要です
- config.jsonとすべての設定が同梱されているため、設定作業不要です
- インターネット接続が必要なのはBox APIアクセス時のみです
- 生成されたHTMLダッシュボードはオフラインで閲覧可能です
- 累積データはdata/box_audit.dbに保存されます（削除しないこと）


■ カスタマイズ（オプション）

設定を変更したい場合は、.envファイルを編集してください。

主な設定項目:
- BOX_ROOT_FOLDER_ID: 監視対象フォルダID
- ALERT_ENABLED: 異常検知の有効/無効（デフォルト: False）
- BUSINESS_HOURS_START/END: 勤務時間設定


■ サポート

問題が発生した場合は、実行ログを確認の上、管理者に連絡してください。

================================================================================
